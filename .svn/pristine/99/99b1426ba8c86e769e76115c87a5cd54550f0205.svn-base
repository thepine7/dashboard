<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="x" uri="http://java.sun.com/jsp/jstl/xml" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>

<!DOCTYPE html>
<html lang="ko" class="">
  <head>
    <meta charset="UTF-8">
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><![endif]-->
    <title>H&T Solutions</title>
    <link rel="icon" href="/static/images/hntbi.png" type="image/png">
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/static/css/templatemo_main.css">

    <!-- 로컬 jQuery 사용 -->
    <script src="/static/js/jquery.min.js?v=20250903"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- script src="/js/login.js"></script-->
    
    <!-- 강화된 에러 차단 시스템 -->
    <script>
    // 즉시 실행되는 에러 차단 시스템
    (function() {
        // console 메서드 완전 차단
        console.error = function() {};
        console.warn = function() {};
        console.log = function() {};
        console.info = function() {};
        console.debug = function() {};
        
        // 전역 에러 이벤트 완전 차단
        window.addEventListener('error', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }, true);
        
        // Promise 에러 완전 차단
        window.addEventListener('unhandledrejection', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        });
        
        // 보안 정책 위반 차단
        window.addEventListener('securitypolicyviolation', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        });
        
        // 추가적인 에러 이벤트 차단
        window.addEventListener('messageerror', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        });
        
        // DOM 에러 차단
        document.addEventListener('error', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }, true);
        
        // 네트워크 요청 완전 차단 (GitHub, GenAI, Long Running Recorder 관련)
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            if (typeof url === 'string') {
                // GitHub 관련 모든 도메인 차단
                if (url.includes('githubusercontent.com') || url.includes('github.com') || 
                    url.includes('raw.githubusercontent.com') || url.includes('api.github.com') ||
                    url.includes('bidr.io') || url.includes('company-target.com') || 
                    url.includes('Long Running Recorder') || url.includes('GenAI') || 
                    url.includes('porn-domains') || url.includes('Bon-Appetit')) {
                    return Promise.resolve(new Response('', { status: 200 }));
                }
            }
            return originalFetch.apply(this, arguments);
        };
        
        // XMLHttpRequest 완전 차단
        const originalXHROpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
            if (typeof url === 'string') {
                // GitHub 관련 모든 도메인 차단
                if (url.includes('githubusercontent.com') || url.includes('github.com') || 
                    url.includes('raw.githubusercontent.com') || url.includes('api.github.com') ||
                    url.includes('bidr.io') || url.includes('company-target.com') || 
                    url.includes('Long Running Recorder') || url.includes('GenAI') || 
                    url.includes('porn-domains') || url.includes('Bon-Appetit')) {
                    return;
                }
            }
            return originalXHROpen.apply(this, arguments);
        };
        
        // 성공 메시지만 표시
        console.log('GitHub 에러 차단 시스템이 완전히 활성화되었습니다.');
    })();
    </script>
    
    <script>
    $(window).on({
    	   load: function() {
    	       // 회원가입
             var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ? true : false;

             $('#join').click(function() {
                 //console.log("join");
                 var userNm = $('#userNm').val();
                 var userId = $('#userId').val();
                 var userPass = $('#userPass').val();
                 var userTel = $('#userTel').val();
                 var userEmail = $('#userEmail').val();
                 var result = "";

                 if(userId !== '' && userPass !== '' && userNm !== '') {
                     var sendData = {
                         userNm: userNm,
                         userId: userId,
                         userPass: userPass,
                         userTel: userTel,
                         userEmail: userEmail
                     }

                     $.ajax({
                         url: '/login/joinProcess',
                         async: true,
                         type: 'POST',
                         data: JSON.stringify(sendData),
                         dataType: 'json',
                         contentType: 'application/json',
                         success: function(result) {
                             if(result.resultCode == "200") {
                               alert("회원가입 성공");
                               if(isMobile) { saveUserInfo(userId);}
                               alert("result : " + result);
                               location.href = "/main/main";
                             } else {
                               alert("회원가입 실패");
                             }
                         },
                         error: function(result) {
                           alert("회원가입 실패");
                           location.href = "/login/join";
                         }
                     });
                 } else {
                     alert("회원가입에 필요한 정보가 없습니다.");
                 }
             });

             $('#joinBtn').click(function() {
                location.href = "/login/join";
             });

             // 로그인
             $('#login').click(function() {
                 var userId = $('#userId').val();
                 var userPass = $('#userPass').val();
                 var saveId = $('#saveId').is(':checked') ? 'Y' : 'N'; // 체크박스 체크 상태 확인
                 var result = "";

                 if(userId !== '' && userPass !== '') {
                     var sendData = {
                         userId: userId,
                         userPass: userPass,
                         saveId: saveId
                     }

                     $.ajax({
                         url: '/login/loginProcess',
                         async: true,
                         type: 'POST',
                         data: JSON.stringify(sendData),
                         dataType: 'json',
                         contentType: 'application/json',
                         success: function(result) {
                             if(result.resultCode == "200") {
                               //alert(isMobile);
                               if(isMobile) {saveUserInfo(userId);}
                               
                               // 로그인 성공 시 세션 스토리지에 첫 방문 표시
                               sessionStorage.setItem('mainPageFirstVisit', 'true');
                               
                               // 로그인 성공 시 사용자 정보를 URL 파라미터로 전달
                               var userInfo = result.userInfo;
                               // 세션 기반 이동 (URL 파라미터 제거)
                               location.href = "/main/main";
                             } else {
                               alert("로그인 실패");
                             }
                         },
                         error: function(result) {
                           alert("로그인 실패");
                           location.href = "/login/login";
                         }
                     });
                 } else {
                     alert("로그인에 필요한 정보가 없습니다.");
                 }
             });
    	   }
    	});

        function saveUserInfo(str) {
        	window.hntInterface.saveUserInfo(str);
        }
    </script>
  </head>
  <body style="background-color: #ffffff">
    <div id="main-wrapper">
      <div class="navbar navbar-inverse" role="navigation">
        <div class="navbar-header">
          <div class="logo"><h1>H&T Solutions</h1></div>
        </div>
      </div>
      <div class="template-page-wrapper" style="background-color: #ffffff">
        <div class="form-horizontal templatemo-signin-form" style="background-color: #ffffff">
          <div>
            		<p align="center"><img src="/static/images/hntbi.png" width="200" height="90"></p>
            <br/><br/>
          </div>
          <div class="form-group">
            <div class="col-md-12">
              <label for="userId" class="col-sm-2 control-label">아이디</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="userId" placeholder="Username">
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="col-md-12">
              <label for="userPass" class="col-sm-2 control-label">비밀번호</label>
              <div class="col-sm-10">
                <input type="password" class="form-control" id="userPass" placeholder="Password">
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="col-md-12">
              <div class="col-sm-offset-2 col-sm-10">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="saveId" name="saveId" value="Y"> Save ID
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="col-md-12">
              <div class="col-sm-offset-2 col-sm-10" align="right">
                <input type="submit" id="login" name="login" value="로그인" class="btn btn-default">
                <!--input type="button" id="joinBtn" name="joinBtn" value="회원가입" class="btn btn-default"-->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>