=== ì„¸ì…˜ ì¶”ì ì„ ìœ„í•œ Servlet Filter + HandlerInterceptor íŒ¨ì¹˜ ===

## ğŸ“ ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼ë“¤

### 1. SessionTrackingFilter.java
```diff
+ package com.andrew.hnt.api.filter;
+ 
+ import org.slf4j.Logger;
+ import org.slf4j.LoggerFactory;
+ import org.springframework.core.annotation.Order;
+ import org.springframework.stereotype.Component;
+ 
+ import javax.servlet.*;
+ import javax.servlet.http.HttpServletRequest;
+ import javax.servlet.http.HttpServletResponse;
+ import javax.servlet.http.HttpSession;
+ import java.io.IOException;
+ import java.util.Enumeration;
+ import java.util.HashMap;
+ import java.util.Map;
+ 
+ /**
+  * ì„¸ì…˜ ì¶”ì ì„ ìœ„í•œ Servlet Filter
+  * ë¡œê·¸ì¸ â†’ ë©”ì¸ í˜ì´ì§€ íë¦„ì—ì„œ ì„¸ì…˜ ë³€í™”ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.
+  */
+ @Component
+ @Order(1) // ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •
+ public class SessionTrackingFilter implements Filter {
+     
+     private static final Logger logger = LoggerFactory.getLogger(SessionTrackingFilter.class);
+     
+     // ... (ì „ì²´ êµ¬í˜„ ë‚´ìš©)
+ }
```

### 2. SessionTrackingInterceptor.java
```diff
+ package com.andrew.hnt.api.interceptor;
+ 
+ import org.slf4j.Logger;
+ import org.slf4j.LoggerFactory;
+ import org.springframework.stereotype.Component;
+ import org.springframework.web.servlet.HandlerInterceptor;
+ import org.springframework.web.servlet.ModelAndView;
+ 
+ import javax.servlet.http.HttpServletRequest;
+ import javax.servlet.http.HttpServletResponse;
+ import javax.servlet.http.HttpSession;
+ import java.util.Enumeration;
+ import java.util.HashMap;
+ import java.util.Map;
+ import java.util.Objects;
+ 
+ /**
+  * ì„¸ì…˜ ì¶”ì ì„ ìœ„í•œ HandlerInterceptor
+  * ì»¨íŠ¸ë¡¤ëŸ¬ ì§„ì… ì „/í›„ ì„¸ì…˜ ë³€í™”ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.
+  */
+ @Component
+ public class SessionTrackingInterceptor implements HandlerInterceptor {
+     
+     // ... (ì „ì²´ êµ¬í˜„ ë‚´ìš©)
+ }
```

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼ë“¤

### 3. WebConfig.java
```diff
  import com.andrew.hnt.api.interceptor.PerformanceInterceptor;
+ import com.andrew.hnt.api.interceptor.SessionTrackingInterceptor;
- import com.andrew.hnt.api.service.PerformanceMonitoringService;
- import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.context.annotation.Bean;
  import org.springframework.context.annotation.Configuration;
  import org.springframework.web.servlet.config.annotation.CorsRegistry;
  import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
  import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
  import org.springframework.web.servlet.view.InternalResourceViewResolver;

  @Configuration
  public class WebConfig implements WebMvcConfigurer {

      @Bean
      public PerformanceInterceptor performanceInterceptor() {
          return new PerformanceInterceptor();
      }
+     
+     @Bean
+     public SessionTrackingInterceptor sessionTrackingInterceptor() {
+         return new SessionTrackingInterceptor();
+     }

      // ... (ê¸°ì¡´ ì½”ë“œ)

      @Override
      public void addInterceptors(InterceptorRegistry registry) {
+         // ì„¸ì…˜ ì¶”ì  ì¸í„°ì…‰í„° ë“±ë¡ (ë¡œê·¸ì¸/ë©”ì¸ í˜ì´ì§€ ì¶”ì )
+         registry.addInterceptor(sessionTrackingInterceptor())
+                 .addPathPatterns(
+                     "/login/loginProcess",
+                     "/main/main",
+                     "/api/auth/me"
+                 );
+         
          // ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì¸í„°ì…‰í„° ë“±ë¡
          registry.addInterceptor(performanceInterceptor())
                  .addPathPatterns("/**")
                  .excludePathPatterns(
                      "/css/**",
                      "/js/**", 
                      "/images/**",
                      "/fonts/**",
                      "/plugins/**",
                      "/dist/**",
                      "/favicon.ico"
                  );
      }
  }
```

## ğŸ”§ ê¸°ëŠ¥ ì„¤ëª…

### SessionTrackingFilter ê¸°ëŠ¥
- **ìš”ì²­ë³„ ì„¸ì…˜ ìŠ¤ëƒ…ìƒ·**: sessionId, isNew, attributeNames/values (ìµœëŒ€ 10ê°œ)
- **ìš”ì²­ íƒœê·¸ êµ¬ë¶„**: LOGIN_POST, LOGIN_GET, MAIN_GET, MAIN_REDIRECT, AUTH_ME ë“±
- **ì¿ í‚¤ ì¶”ì **: JSESSIONID ì¿ í‚¤ ìƒì„¸ ì •ë³´ (Domain, Path, Secure, HttpOnly)
- **ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²´ì¸ ì¶”ì **: Location í—¤ë”, ìƒíƒœì½”ë“œ, ë™ì¼/êµì°¨ ë„ë©”ì¸ ì—¬ë¶€
- **Set-Cookie í—¤ë” í™•ì¸**: ì¿ í‚¤ ì¬ì„¤ì • ì—¬ë¶€ ë° ìƒì„¸ ë‚´ìš©

### SessionTrackingInterceptor ê¸°ëŠ¥
- **ì»¨íŠ¸ë¡¤ëŸ¬ ì§„ì… ì „/í›„ ë¹„êµ**: preHandle/postHandleì—ì„œ ì„¸ì…˜ diff ë¶„ì„
- **í•µì‹¬ í‚¤ ê°•ì¡°**: SESSION_USER_ID, userId ë“± ì¤‘ìš” ì†ì„± ë³€í™” ì¶”ì 
- **ThreadLocal ì‚¬ìš©**: ìš”ì²­ë³„ ì„¸ì…˜ ìŠ¤ëƒ…ìƒ· ì•ˆì „í•˜ê²Œ ì €ì¥
- **ë³€í™” ë¶„ì„**: ì¶”ê°€/ì‚­ì œ/ë³€ê²½ëœ ì†ì„± ìƒì„¸ ë¡œê¹…

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. ì ìš©
```bash
# ë¹Œë“œ
mvn clean package -DskipTests

# ë°°í¬ (tomcat2)
copy target\hnt-sensor-api-0.0.1-SNAPSHOT.war Y:\docker\tomcat2\ROOT.war
```

### 2. ë¡œê·¸ í™•ì¸
ë¡œê·¸ì¸ â†’ ë©”ì¸ í˜ì´ì§€ íë¦„ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë¡œê·¸ê°€ ì¶œë ¥ë©ë‹ˆë‹¤:

```
=== [LOGIN_POST] ìš”ì²­ ì‹œì‘ ===
URL: POST /login/loginProcess
[LOGIN_POST] ìš”ì²­ ì „ ì„¸ì…˜: ì—†ìŒ
[LOGIN_POST] ìš”ì²­ í›„ ì„¸ì…˜ ìŠ¤ëƒ…ìƒ·:
  - ì„¸ì…˜ ID: ABC123
  - isNew: true
  ğŸ”‘ SESSION_USER_ID: thepine
  ğŸ”‘ userId: thepine

=== [INTERCEPTOR] ì»¨íŠ¸ë¡¤ëŸ¬ ì§„ì… ì „ ===
[INTERCEPTOR] preHandle ì„¸ì…˜ ìŠ¤ëƒ…ìƒ· ì €ì¥ ì™„ë£Œ
ğŸ”‘ SESSION_USER_ID: thepine

=== [INTERCEPTOR] ì»¨íŠ¸ë¡¤ëŸ¬ ì²˜ë¦¬ í›„ ===
ğŸ“ í•µì‹¬ ì†ì„± ë³€í™”:
  â• SESSION_USER_ID: null â†’ thepine
  â• userId: null â†’ thepine

=== [MAIN_GET] ìš”ì²­ ì‹œì‘ ===
URL: GET /main/main
[MAIN_GET] ìš”ì²­ ì „ ì„¸ì…˜ ìŠ¤ëƒ…ìƒ·:
  - ì„¸ì…˜ ID: ABC123
  - isNew: false
  ğŸ”‘ SESSION_USER_ID: thepine
  ğŸ”‘ userId: thepine
```

## ğŸ”„ ë˜ëŒë¦¬ê¸° ë°©ë²•

### 1. íŒŒì¼ ì‚­ì œ
```bash
# ìƒì„±ëœ íŒŒì¼ë“¤ ì‚­ì œ
rm src/main/java/com/andrew/hnt/api/filter/SessionTrackingFilter.java
rm src/main/java/com/andrew/hnt/api/interceptor/SessionTrackingInterceptor.java
```

### 2. WebConfig.java ë˜ëŒë¦¬ê¸°
```diff
  import com.andrew.hnt.api.interceptor.PerformanceInterceptor;
- import com.andrew.hnt.api.interceptor.SessionTrackingInterceptor;
  import org.springframework.context.annotation.Bean;
  import org.springframework.context.annotation.Configuration;
  import org.springframework.web.servlet.config.annotation.CorsRegistry;
  import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
  import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
  import org.springframework.web.servlet.view.InternalResourceViewResolver;

  @Configuration
  public class WebConfig implements WebMvcConfigurer {

      @Bean
      public PerformanceInterceptor performanceInterceptor() {
          return new PerformanceInterceptor();
      }
-     
-     @Bean
-     public SessionTrackingInterceptor sessionTrackingInterceptor() {
-         return new SessionTrackingInterceptor();
-     }

      // ... (ê¸°ì¡´ ì½”ë“œ)

      @Override
      public void addInterceptors(InterceptorRegistry registry) {
-         // ì„¸ì…˜ ì¶”ì  ì¸í„°ì…‰í„° ë“±ë¡ (ë¡œê·¸ì¸/ë©”ì¸ í˜ì´ì§€ ì¶”ì )
-         registry.addInterceptor(sessionTrackingInterceptor())
-                 .addPathPatterns(
-                     "/login/loginProcess",
-                     "/main/main",
-                     "/api/auth/me"
-                 );
-         
          // ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì¸í„°ì…‰í„° ë“±ë¡
          registry.addInterceptor(performanceInterceptor())
                  .addPathPatterns("/**")
                  .excludePathPatterns(
                      "/css/**",
                      "/js/**", 
                      "/images/**",
                      "/fonts/**",
                      "/plugins/**",
                      "/dist/**",
                      "/favicon.ico"
                  );
      }
  }
```

### 3. ì¬ë¹Œë“œ ë° ë°°í¬
```bash
mvn clean package -DskipTests
copy target\hnt-sensor-api-0.0.1-SNAPSHOT.war Y:\docker\tomcat2\ROOT.war
```

## ğŸ“Š ì˜ˆìƒ ë¡œê·¸ ì¶œë ¥ ì˜ˆì‹œ

### ë¡œê·¸ì¸ ì„±ê³µ ì‹œ
```
=== [LOGIN_POST] ìš”ì²­ ì‹œì‘ ===
URL: POST /login/loginProcess
[LOGIN_POST] ìš”ì²­ ì „ ì„¸ì…˜: ì—†ìŒ
[LOGIN_POST] ìš”ì²­ í›„ ì„¸ì…˜ ìŠ¤ëƒ…ìƒ·:
  - ì„¸ì…˜ ID: 1A2B3C4D5E6F7G8H
  - isNew: true
  ğŸ”‘ SESSION_USER_ID: thepine
  ğŸ”‘ SESSION_USER_GRADE: A
  ğŸ”‘ userId: thepine
  ğŸ”‘ userGrade: A
[LOGIN_POST] ì‘ë‹µ ìƒíƒœ: 200
[LOGIN_POST] Set-Cookie: ìˆìŒ
Set-Cookie: JSESSIONID=1A2B3C4D5E6F7G8H; Path=/; HttpOnly; SameSite=Lax

=== [MAIN_GET] ìš”ì²­ ì‹œì‘ ===
URL: GET /main/main
[MAIN_GET] ìš”ì²­ ì „ ì„¸ì…˜ ìŠ¤ëƒ…ìƒ·:
  - ì„¸ì…˜ ID: 1A2B3C4D5E6F7G8H
  - isNew: false
  ğŸ”‘ SESSION_USER_ID: thepine
  ğŸ”‘ userId: thepine
[MAIN_GET] ì‘ë‹µ ìƒíƒœ: 200
[MAIN_GET] Set-Cookie: ì—†ìŒ
```

### ì„¸ì…˜ ê²€ì¦ ì‹¤íŒ¨ ì‹œ
```
=== [MAIN_GET] ìš”ì²­ ì‹œì‘ ===
URL: GET /main/main
[MAIN_GET] ìš”ì²­ ì „ ì„¸ì…˜: ì—†ìŒ
[MAIN_GET] ì‘ë‹µ ìƒíƒœ: 302
ğŸ”„ ë¦¬ë‹¤ì´ë ‰íŠ¸: 302 â†’ /login/login
ë„ë©”ì¸: ë™ì¼
[MAIN_GET] Set-Cookie: ì—†ìŒ
```

ì´ íŒ¨ì¹˜ë¥¼ í†µí•´ ë¡œê·¸ì¸ â†’ ë©”ì¸ í˜ì´ì§€ íë¦„ì—ì„œ ì„¸ì…˜ ì •ë³´ê°€ ì–¸ì œ, ì–´ë””ì„œ, ì–´ë–»ê²Œ ë³€í™”í•˜ëŠ”ì§€ ì •í™•íˆ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
